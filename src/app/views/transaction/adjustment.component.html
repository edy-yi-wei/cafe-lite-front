<div class="animated fadeIn">
  <!--HEADER FOR ACTION BUTTONS-->
  <div>
    <button type="button" class="btn btn-secondary" (click)="addNew()"><i class="icon-plus"></i> Baru</button>
    <button type="button" class="btn btn-primary" (click)="saveTransaction()"><i class="icon-paper-plane"></i>
      Simpan</button>
  </div>
  <br />
  <form [formGroup]="purchasingForm">
    <div class="row">
      <div class="col-md-3">
        <div class="card">
          <div class="card-body">
            <ng-container formGroupName="purchasing">
              <div class="row">
                <div class="form-group col-md-8">
                    <label for="supplier">Supplier</label>
                    <select class="form-control form-control-sm" formControlName="supplierId">
                      <option *ngFor="let supp of list_supplier" [value]="supp.supplierId">{{supp.supplierName}}
                      </option>
                    </select>
                  </div>
              </div>
              <div class="row">
                <div class="form-group col-md-8">
                  <label for="amount">Subtotal</label>
                <br>
                  {{purchasingForm.controls.purchasing.controls.amount.value | number: ''}}
                </div>
              </div>
              <div class="row">
                <div class="form-group col-md-8">
                  <label for="discount">Discount (%)</label>
                  <input type="text" mask="0{3}" formControlName="discount" (change)="calculateNetto()" class="form-control form-control-sm"
                    placeholder="0">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-md-8">
                  <label for="netto">Total</label>
              <br>
              {{purchasingForm.controls.purchasing.controls.netto.value | number: ''}}
                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
      <div class="col-md-9">
        <div class="card">
          <div class="card-body">
            <button type="button" class="btn btn-primary btn-sm" (click)="addMaterial()" style="margin-bottom: 10px;"><i
                class="icon-plus"></i> Add</button>
            <div class="table-responsive">
              <table class="table table-striped form-control-sm">
                <thead>
                  <tr>
                    <th></th>
                    <th>Nama Material</th>
                    <th>Kode Material</th>
                    <th>UoM</th>
                    <th>Quantity</th>
                    <th>Harga</th>
                    <th>Jumlah</th>
                  </tr>
                </thead>
                <tbody style="overflow-y: auto">
                  <tr formArrayName="purchasing_details" *ngFor="let md of purchasingForm.get('purchasing_details').controls; let i = index">
                      <td><button class="btn btn-ghost-danger btn-sm" (click)="deleteMaterial(i)"><i class="icon-trash"></i></button>
                      </td>
                      <ng-container [formGroupName]="i">
                        <ng-container formGroupName="material">
                        <td>
                          <select class="form-control form-control-sm" formControlName="materialId"
                            (change)="loadDetail(i, $event.target.value)">
                            <option *ngFor="let mat of list_material" [value]="mat.materialId">{{mat.materialName}}
                            </option>
                          </select>
                        </td>
                        <td>
                          {{md.value.material.materialCode}}
                        </td>
                        <td>
                          {{md.value.material.uom}}
                        </td>
                        </ng-container>
                      </ng-container>
                      <td [formGroupName]="i">
                        <input type="text" mask = "comma_separator.2" formControlName="quantity" (change)="calculateTotal(i)" class="form-control form-control-sm" style="text-align: right;width: 200px"
                          placeholder="0">
                      </td>
                      <td [formGroupName]="i">
                        <input type="text" mask = "comma_separator.2" formControlName="price" (change)="calculateTotal(i)" class="form-control form-control-sm" style="text-align: right;width: 200px"
                          placeholder="0">
                      </td>
                      <td [formGroupName]="i" align="right">
                        {{md.value.total | number: ''}}
                      </td>
                  </tr>
                </tbody>
              </table>
            </div>
      
          </div>
        </div>
      </div>
      <!--/.col-->
    </div>
    <!--/.row-->
  </form>
</div>